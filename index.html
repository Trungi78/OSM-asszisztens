<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b6cff" />
  <link rel="manifest" href="manifest.json" />
  <title>OSM Taktikai Asszisztens v6 Pro (PWA)</title>
  <style>
    :root{--bg:#0b1220;--card:#121b2e;--muted:#8aa0c7;--text:#eaf0ff;--pri:#0b6cff;--ok:#1ed760;--warn:#ffcc00;--bad:#ff4757;}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#081022 0%,#0b1220 60%,#070d18 100%);color:var(--text)}
    header{position:sticky;top:0;z-index:5;background:rgba(7,13,24,.8);backdrop-filter:blur(10px);border-bottom:1px solid rgba(138,160,199,.12)}
    .wrap{max-width:1100px;margin:0 auto;padding:14px 14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    h1{font-size:18px;margin:0;letter-spacing:.2px}
    .badge{font-size:12px;color:#cfe0ff;background:rgba(11,108,255,.16);border:1px solid rgba(11,108,255,.35);padding:4px 8px;border-radius:999px}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button.tab{background:rgba(18,27,46,.9);color:var(--text);border:1px solid rgba(138,160,199,.15);padding:10px 12px;border-radius:12px;cursor:pointer}
    button.tab.active{border-color:rgba(11,108,255,.6);box-shadow:0 0 0 2px rgba(11,108,255,.12) inset}
    main{padding:18px 14px}
    .grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){.grid{grid-template-columns:1.05fr .95fr}}
    .card{background:rgba(18,27,46,.88);border:1px solid rgba(138,160,199,.12);border-radius:16px;padding:14px}
    .card h2{margin:0 0 10px 0;font-size:16px}
    .muted{color:var(--muted);font-size:13px;line-height:1.35}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    .kpi .box{background:rgba(7,13,24,.55);border:1px solid rgba(138,160,199,.12);border-radius:14px;padding:10px}
    .kpi .n{font-size:18px;font-weight:700}
    .kpi .l{font-size:12px;color:var(--muted)}
    .form{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:900px){.form{grid-template-columns:repeat(2,1fr)}}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(138,160,199,.18);
      background:rgba(7,13,24,.65);color:var(--text);outline:none
    }
    textarea{min-height:84px;resize:vertical}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{border:0;border-radius:12px;padding:10px 12px;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--pri);color:white}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(138,160,199,.18)}
    .btn.good{background:rgba(30,215,96,.18);border:1px solid rgba(30,215,96,.35);color:#dbffe8}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;border:1px solid rgba(138,160,199,.15);background:rgba(7,13,24,.45);font-size:12px;color:var(--muted)}
    .sep{height:1px;background:rgba(138,160,199,.12);margin:12px 0}
    .list{display:grid;gap:8px}
    .item{padding:10px;border-radius:14px;border:1px solid rgba(138,160,199,.12);background:rgba(7,13,24,.45)}
    .item b{display:block}
    .ok{color:#a6ffcf}
    .warn{color:#ffe38a}
    .bad{color:#ffb0b7}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:14px;z-index:99;max-width:92vw;
      background:rgba(7,13,24,.92);border:1px solid rgba(138,160,199,.2);padding:10px 12px;border-radius:14px;
      color:var(--text);display:none
    }
    .rightcol{display:grid;gap:12px}
    .small{font-size:12px}
    .footer{max-width:1100px;margin:18px auto 40px auto;padding:0 14px;color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <h1>OSM Taktikai Asszisztens <span class="badge">v6 Pro ‚Ä¢ PWA</span></h1>
      <div class="pill" id="installPill">üì≤ Telep√≠t√©s: <span id="installState">ellen≈ërz√©s‚Ä¶</span></div>
    </div>
    <nav>
      <button class="tab active" data-tab="match">Match Setup</button>
      <button class="tab" data-tab="opponent">Opponent Analyzer</button>
      <button class="tab" data-tab="tactic">Tactic Calculator</button>
      <button class="tab" data-tab="setpieces">Set Pieces</button>
      <button class="tab" data-tab="about">Info</button>
    </nav>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card" id="leftCard"></section>

    <aside class="rightcol">
      <section class="card">
        <h2>Gyors √∂sszefoglal√≥</h2>
        <div class="muted">A kalkul√°torok offline is m≈±k√∂dnek (PWA). Mentsd el a meccs adatokat, √©s visszat√∂lthet≈ëk.</div>
        <div class="kpi">
          <div class="box"><div class="n" id="kpiTeam">‚Äî</div><div class="l">Csapat er≈ë</div></div>
          <div class="box"><div class="n" id="kpiOpp">‚Äî</div><div class="l">Ellenf√©l er≈ë</div></div>
          <div class="box"><div class="n" id="kpiEdge">‚Äî</div><div class="l">El≈ëny (tipp)</div></div>
        </div>
        <div class="sep"></div>
        <div class="actions">
          <button class="btn primary" id="btnSaveAll">Ment√©s</button>
          <button class="btn ghost" id="btnLoadAll">Bet√∂lt√©s</button>
          <button class="btn ghost" id="btnResetAll">Null√°z√°s</button>
        </div>
      </section>

      <section class="card">
        <h2>Aj√°nlott pontr√∫g√≥k (gyorslogika)</h2>
        <div class="muted small">
          Alapelv: <b>pontr√∫g√°s</b> ‚Üí legjobb ‚ÄûT√°m‚Äù + j√≥ mor√°l/√°llapot; <b>kapit√°ny</b> ‚Üí tapasztalt, magas mor√°l; <b>b√ºntet≈ë</b> ‚Üí legjobb T√°m + stabil (kev√©s lap).
        </div>
        <div class="sep"></div>
        <div class="list" id="quickSetPieceList"></div>
      </section>

      <section class="card">
        <h2>Offline √°llapot</h2>
        <div class="muted">
          <span id="swState">Service worker: ellen≈ërz√©s‚Ä¶</span><br/>
          <span class="mono" id="cacheState">Cache: ‚Äî</span>
        </div>
      </section>
    </aside>
  </div>
</main>

<div class="footer">
  Tipp: Androidon a b√∂ng√©sz≈ë men√º ‚Üí ‚ÄûHozz√°ad√°s a kezd≈ëk√©perny≈ëh√∂z‚Äù. Ha az ‚ÄûInstall‚Äù felugrik, telep√≠thet≈ë.
</div>

<div class="toast" id="toast"></div>

<script>
const state = {
  match: { homeAway: "away", competition: "league", referee: "yellow", pitch: "normal" },
  ratings: { teamGK:0, teamDEF:0, teamMID:0, teamATT:0, teamOverall:0, oppGK:0, oppDEF:0, oppMID:0, oppATT:0, oppOverall:0 },
  tactics: {
    formation:"4-3-3A", gamePlan:"short", tackling:"normal", marking:"zonal",
    pressing:63, style:69, tempo:59, offsideTrap:false
  },
  setpieces: { freeKick:"", corner:"", penalty:"", captain:"" },
  players: []
};
const LS_KEY = "osm_v6_pro_state";

function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg; t.style.display = "block";
  clearTimeout(window.__toastTO);
  window.__toastTO = setTimeout(()=> t.style.display="none", 2200);
}
function saveAll(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
  toast("Mentve ‚úÖ");
  refreshKPIs(); renderQuickSetPieces();
}
function loadAll(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw) return;
  try{
    const obj = JSON.parse(raw);
    Object.assign(state, obj);
    if(obj.match) Object.assign(state.match, obj.match);
    if(obj.ratings) Object.assign(state.ratings, obj.ratings);
    if(obj.tactics) Object.assign(state.tactics, obj.tactics);
    if(obj.setpieces) Object.assign(state.setpieces, obj.setpieces);
    if(obj.players) state.players = obj.players;
  }catch(e){ console.error(e); }
}
function resetAll(){ localStorage.removeItem(LS_KEY); toast("Null√°zva üßπ"); }

document.getElementById("btnSaveAll").addEventListener("click", saveAll);
document.getElementById("btnLoadAll").addEventListener("click", ()=>{ loadAll(); renderActiveTab(); refreshKPIs(); renderQuickSetPieces(); toast("Bet√∂ltve ‚úÖ"); });
document.getElementById("btnResetAll").addEventListener("click", resetAll);

const tabs = [...document.querySelectorAll("button.tab")];
let activeTab = "match";
tabs.forEach(b => b.addEventListener("click", () => {
  tabs.forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  activeTab = b.dataset.tab;
  renderActiveTab();
}));

function renderActiveTab(){
  const host = document.getElementById("leftCard");
  host.innerHTML = "";
  if(activeTab === "match") host.appendChild(renderMatchSetup());
  if(activeTab === "opponent") host.appendChild(renderOpponentAnalyzer());
  if(activeTab === "tactic") host.appendChild(renderTacticCalculator());
  if(activeTab === "setpieces") host.appendChild(renderSetPieces());
  if(activeTab === "about") host.appendChild(renderAbout());
}

function renderMatchSetup(){
  const el = document.createElement("div");
  el.innerHTML = `
    <h2>Match Setup</h2>
    <div class="muted">Hazai/idegen, b√≠r√≥, kupa/bajnoks√°g. (S√°rga b√≠r√≥ = Normal tackling j√≥ alap.)</div>
    <div class="sep"></div>
    <div class="form">
      <div><label>Hazai / Idegen</label>
        <select id="ms_homeAway"><option value="home">Hazai</option><option value="away">Idegen</option></select>
      </div>
      <div><label>Sorozat</label>
        <select id="ms_comp"><option value="league">Bajnoki</option><option value="cup">Kupa</option></select>
      </div>
      <div><label>B√≠r√≥ sz√≠ne</label>
        <select id="ms_ref"><option value="green">Z√∂ld</option><option value="yellow">S√°rga</option><option value="red">Piros</option></select>
      </div>
      <div><label>P√°lya (opcion√°lis)</label>
        <select id="ms_pitch"><option value="normal">Norm√°l</option><option value="wet">Nedves</option><option value="dry">Sz√°raz</option></select>
      </div>
    </div>
    <div class="sep"></div>
    <div class="actions">
      <button class="btn primary" id="ms_apply">Alkalmaz</button>
      <button class="btn ghost" id="ms_suggest">Tackling tipp</button>
    </div>
  `;
  el.querySelector("#ms_homeAway").value = state.match.homeAway;
  el.querySelector("#ms_comp").value = state.match.competition;
  el.querySelector("#ms_ref").value = state.match.referee;
  el.querySelector("#ms_pitch").value = state.match.pitch;

  el.querySelector("#ms_apply").addEventListener("click", () => {
    state.match.homeAway = el.querySelector("#ms_homeAway").value;
    state.match.competition = el.querySelector("#ms_comp").value;
    state.match.referee = el.querySelector("#ms_ref").value;
    state.match.pitch = el.querySelector("#ms_pitch").value;
    saveAll();
  });
  el.querySelector("#ms_suggest").addEventListener("click", () => {
    const r = state.match.referee;
    state.tactics.tackling = (r==="red") ? "soft" : (r==="yellow") ? "normal" : "hard";
    toast("Tackling ‚Üí " + state.tactics.tackling.toUpperCase());
    saveAll();
  });
  return el;
}

function renderOpponentAnalyzer(){
  const el = document.createElement("div");
  el.innerHTML = `
    <h2>Opponent Analyzer</h2>
    <div class="muted">Add meg a csapatr√©szek er≈ëss√©geit, √©s kapsz gyors el≈ëny-tippet.</div>
    <div class="sep"></div>
    <div class="form">
      <div><label>Saj√°t: Kapus</label><input type="number" id="t_gk" min="0" max="150" /></div>
      <div><label>Ellenf√©l: Kapus</label><input type="number" id="o_gk" min="0" max="150" /></div>
      <div><label>Saj√°t: V√©delem</label><input type="number" id="t_def" min="0" max="150" /></div>
      <div><label>Ellenf√©l: V√©delem</label><input type="number" id="o_def" min="0" max="150" /></div>
      <div><label>Saj√°t: K√∂z√©pp√°lya</label><input type="number" id="t_mid" min="0" max="150" /></div>
      <div><label>Ellenf√©l: K√∂z√©pp√°lya</label><input type="number" id="o_mid" min="0" max="150" /></div>
      <div><label>Saj√°t: T√°mad√°s</label><input type="number" id="t_att" min="0" max="150" /></div>
      <div><label>Ellenf√©l: T√°mad√°s</label><input type="number" id="o_att" min="0" max="150" /></div>
    </div>
    <div class="sep"></div>
    <div class="actions">
      <button class="btn primary" id="oa_calc">Sz√°mol</button>
      <button class="btn ghost" id="oa_autofill">P√©lda</button>
    </div>
    <div class="sep"></div>
    <div class="item"><b>√ârt√©kel√©s</b><div class="muted small" id="oa_result">Adj meg adatokat a sz√°m√≠t√°shoz.</div></div>
  `;
  const ids = ["t_gk","t_def","t_mid","t_att","o_gk","o_def","o_mid","o_att"];
  const map = { t_gk:"teamGK", t_def:"teamDEF", t_mid:"teamMID", t_att:"teamATT", o_gk:"oppGK", o_def:"oppDEF", o_mid:"oppMID", o_att:"oppATT" };
  for (const id of ids) {
    el.querySelector("#"+id).value = state.ratings[map[id]] || "";
  }
  function calc(){
    for (const id of ids) {
      const v = Number(el.querySelector("#"+id).value || 0);
      state.ratings[map[id]] = v;
    }
    state.ratings.teamOverall = Math.round((state.ratings.teamGK + state.ratings.teamDEF + state.ratings.teamMID + state.ratings.teamATT)/4);
    state.ratings.oppOverall  = Math.round((state.ratings.oppGK + state.ratings.oppDEF + state.ratings.oppMID + state.ratings.oppATT)/4);
    const edge = state.ratings.teamOverall - state.ratings.oppOverall;
    let msg = "";
    if(edge >= 8) msg = `<span class="ok">Jelent≈ës el≈ëny (+)</span>`;
    else if(edge >= 3) msg = `<span class="ok">Kisebb el≈ëny (+)</span>`;
    else if(edge >= -2) msg = `<span class="warn">Kiegyenl√≠tett ()</span>`;
    else msg = `<span class="bad">H√°tr√°ny ()</span>`;
    el.querySelector("#oa_result").innerHTML =
      `Saj√°t √°tlag: <b></b> ‚Ä¢ Ellenf√©l √°tlag: <b></b><br/>Tipp: `;
    refreshKPIs(); saveAll();
  }
  renderQuickSetPieces();
  initSW();
})();
</script>
</body>
</html>
